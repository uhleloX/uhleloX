/**
 * Implements Bootstrap 5 Select2 4.1
 *
 * @see https://apalfrey.github.io/select2-bootstrap-5-theme/#4-1
 * @since 1.0.0
 * @package uhleloX\admin\js
 */

(function( $ ) {
	'use strict';
		$( window ).on(
			'load',
			function() {

				/**
				 * Instantiate Select2 Bootstrap on 'page_user' input
				 *
				 * This is used when we have relationships between pages and users.
				 * The input will list user/page to select from.
				 */
				if ( document.querySelector( '.x_select2' ) ) {
					$('.x_select2').each( function() {
						$(this).select2( {
							theme: "bootstrap-5",
							width: select_width( this ),
							placeholder: $( this ).data( 'placeholder' ),
						});
					});
				}

				/**
				 * Instantiate Select2 Bootstrap on 'timezone' input
				 *
				 * This is used when we select timezone in setup process.
				 * The input will list available timezones as generated by X_Functions::timezones_select()
				 * @todo remove this and use above .class selector instead.
				 */
				if ( document.querySelector( '#timezone' ) ) {
					$( '#timezone' ).select2( {
						theme: "bootstrap-5",
						width: select_width( this ),
						placeholder: $( this ).data( 'placeholder' ),
					});
				}

				/**
				 * Fix Select2 Bootstrap width dynamically.
				 *
				 * @todo Check if this is still needed. It does not seem so (test selects)
				 * @param object $elementh this element to be adjusted.
				 */
				function select_width( element ) {

					if ( $( element ).data( 'width' ) ) {
						return $( element ).data( 'width' );
					} else if ( $( element ).hasClass( 'w-100' ) ) {
						return '100%';
					} else {
						return 'style';
					}
				}

			}
		);
})( jQuery );
